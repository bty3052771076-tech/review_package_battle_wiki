# 设计文档：Backpack Battles 中文 Wiki 本地复刻

## 总体思路
采用“抓取 -> 结构化处理 -> 静态化渲染 -> 本地索引”流水线，将 MediaWiki 页面转为本地可浏览的静态站点，输出到工作区。以“所有页面（Special:AllPages）”作为全站入口清单，避免遗漏。

## 信息架构
主要页面类型（根据首页与物品页观察）：
- 首页（入口导航、版本更新、站外链接、分类入口）
- 目录/索引页：物品、合成配方、游戏机制、角色、版本历史、分类页
- 详情页：物品/配方/机制/角色等内容页
- 统计与索引：所有页面、分类、版本历史列表

## 页面渲染策略
1. 页面内容获取
   - 优先使用 MediaWiki 页面内容接口（如 `?action=render` 或 API 导出）获取净化 HTML
   - 对于列表型页面保留表格与目录结构
2. 链接处理
   - 站内链接转换为本地相对路径
   - 站外链接保留原 URL
   - 广告链接（app.wiki.gg/showcase 等）过滤
3. 资源处理
   - 下载图片并替换为本地路径
   - 保留必要图标与 Logo

## 离线搜索
轻量搜索方案：
- 抓取页面标题 + 摘要（或正文纯文本）生成索引 JSON
- 前端使用轻量搜索库（如 Fuse.js 或 Lunr.js）实现离线检索

## 目录结构建议
```
site/
  index.html
  pages/
    物品.html
    合成配方.html
    ...
  assets/
    images/
    css/
    js/
  search/
    index.json
```

## 技术选型（候选）
- 抓取：脚本（Python/Node）在工作区虚拟环境执行
- 渲染：模板引擎（Jinja2/Handlebars 等）或直接改写 HTML
- 搜索：Fuse.js / Lunr.js

## 关键实现细节
- 使用 Special:AllPages 分页遍历收集全站主命名空间链接
- 去重与规范化 URL（解码中文路径，统一文件名规则）
- 处理同名页面与特殊字符（文件名安全化）
- 保留许可声明与署名信息（页脚保留 CC BY-SA 4.0）

## 不做项
- 不提供编辑/讨论/历史/登录功能
- 不集成广告与第三方统计
- 不做服务端渲染与部署

## 质量保障
- 抽样页面对比：首页、物品页、合成配方、角色、版本历史
- 链接可用性检查：站内链接可本地打开
- 图片加载完整性检查
